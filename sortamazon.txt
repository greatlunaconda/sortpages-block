Amazon Q
Did you know?
Pinned context is always included in future chat messages
Select code & ask me to explain, debug or optimize it, or type / for quick actions

~/wpexam2/sortpages内です。次のようなwordpressのgutenbergプラグインのコードを示してください>。作成するページにてこのプラグインを使用して、予め用意されている>ソート表示用ページのカスタムフィールドまたプラグインAdvance Custom Field の値を取得して、値によってソート表示用ページの表示の順番>を変化させ作成するページに表示用ページのサムネイルとリンクを表示させます。


Context
まず、現在のディレクトリ構造を確認して、WordPressプラグインの開発環境を理解しましょう。

Allow read-only tools outside your workspace
Allowed
I need permission to list directories outside the workspace.
.

Searched for "sortpages" in
.
12 results found
6 files read
copyright-date-block.php
block.json
index.js
edit.js
save.js
render.php
既存のプラグインを確認しました。カスタムフィールドの値でページをソートして表示するGutenbergブロックを作成します。以下のコードを提供します：

メインプラグインファイル (sortpages-block.php):

<?php
/**
 * Plugin Name:       Sort Pages Block
 * Description:       Display sorted pages with thumbnails and links based on custom field values.
 * Version:           1.0.0
 * Requires at least: 6.0
 * Requires PHP:      7.4
 * Author:            Your Name
 * License:           GPL-2.0-or-later
 * Text Domain:       sortpages-block
 */

if (!defined('ABSPATH')) {
    exit;
}

function sortpages_block_init() {
    register_block_type(__DIR__ . '/build');
}
add_action('init', 'sortpages_block_init');


Copy

Insert at cursor
block.json:

{
    "$schema": "https://schemas.wp.org/trunk/block.json",
    "apiVersion": 3,
    "name": "sortpages/sort-pages-block",
    "version": "1.0.0",
    "title": "Sort Pages Block",
    "category": "widgets",
    "description": "Display sorted pages with custom field values",
    "attributes": {
        "sortField": {
            "type": "string",
            "default": "menu_order"
        },
        "sortOrder": {
            "type": "string",
            "default": "ASC"
        },
        "postType": {
            "type": "string",
            "default": "page"
        },
        "numberOfPosts": {
            "type": "number",
            "default": 10
        }
    },
    "supports": {
        "html": false
    },
    "textdomain": "sortpages-block",
    "editorScript": "file:./index.js",
    "render": "file:./render.php"
}


Copy

Insert at cursor
json
index.js:

import { registerBlockType } from '@wordpress/blocks';
import Edit from './edit';
import metadata from './block.json';

registerBlockType(metadata.name, {
    edit: Edit,
    save: () => null
});

Copy

Insert at cursor
javascript
edit.js:

import { __ } from '@wordpress/i18n';
import { InspectorControls, useBlockProps } from '@wordpress/block-editor';
import { PanelBody, SelectControl, TextControl } from '@wordpress/components';

export default function Edit({ attributes, setAttributes }) {
    const { sortField, sortOrder, postType, numberOfPosts } = attributes;

    return (
        <>
            <InspectorControls>
                <PanelBody title={__('Sort Settings', 'sortpages-block')}>
                    <SelectControl
                        label={__('Post Type', 'sortpages-block')}
                        value={postType}
                        options={[
                            { label: 'Pages', value: 'page' },
                            { label: 'Posts', value: 'post' }
                        ]}
                        onChange={(value) => setAttributes({ postType: value })}
                    />
                    <TextControl
                        label={__('Sort Field (Custom Field Key)', 'sortpages-block')}
                        value={sortField}
                        onChange={(value) => setAttributes({ sortField: value })}
                        help={__('Enter custom field key or "menu_order" for page order', 'sortpages-block')}
                    />
                    <SelectControl
                        label={__('Sort Order', 'sortpages-block')}
                        value={sortOrder}
                        options={[
                            { label: 'Ascending', value: 'ASC' },
                            { label: 'Descending', value: 'DESC' }
                        ]}
                        onChange={(value) => setAttributes({ sortOrder: value })}
                    />
                    <TextControl
                        type="number"
                        label={__('Number of Posts', 'sortpages-block')}
                        value={numberOfPosts}
                        onChange={(value) => setAttributes({ numberOfPosts: parseInt(value) })}
                    />
                </PanelBody>
            </InspectorControls>
            <div {...useBlockProps()}>
                <p>{__('Sort Pages Block - Preview in frontend', 'sortpages-block')}</p>
                <p>{__('Sort by:', 'sortpages-block')} {sortField} ({sortOrder})</p>
            </div>
        </>
    );
}


Copy

Insert at cursor
render.php:

<?php
$sort_field = $attributes['sortField'] ?? 'menu_order';
$sort_order = $attributes['sortOrder'] ?? 'ASC';
$post_type = $attributes['postType'] ?? 'page';
$number_of_posts = $attributes['numberOfPosts'] ?? 10;

$query_args = array(
    'post_type' => $post_type,
    'post_status' => 'publish',
    'posts_per_page' => $number_of_posts,
    'orderby' => $sort_field === 'menu_order' ? 'menu_order' : 'meta_value',
    'order' => $sort_order
);

if ($sort_field !== 'menu_order') {
    $query_args['meta_key'] = $sort_field;
    $query_args['meta_type'] = 'CHAR';
}

$posts = get_posts($query_args);

if (!empty($posts)) {
    echo '<div ' . get_block_wrapper_attributes(['class' => 'sortpages-block']) . '>';
    echo '<div class="sortpages-grid">';
    
    foreach ($posts as $post) {
        $thumbnail = get_the_post_thumbnail($post->ID, 'medium');
        $permalink = get_permalink($post->ID);
        $title = get_the_title($post->ID);
        $custom_field_value = get_post_meta($post->ID, $sort_field, true);
        
        echo '<div class="sortpages-item">';
        if ($thumbnail) {
            echo '<div class="sortpages-thumbnail">';
            echo '<a href="' . esc_url($permalink) . '">' . $thumbnail . '</a>';
            echo '</div>';
        }
        echo '<div class="sortpages-content">';
        echo '<h3><a href="' . esc_url($permalink) . '">' . esc_html($title) . '</a></h3>';
        if ($custom_field_value && $sort_field !== 'menu_order') {
            echo '<p class="sortpages-meta">' . esc_html($sort_field) . ': ' . esc_html($custom_field_value) . '</p>';
        }
        echo '</div>';
        echo '</div>';
    }
    
    echo '</div>';
    echo '</div>';
}
?>

<style>
.sortpages-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.sortpages-item {
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
    transition: box-shadow 0.3s ease;
}

.sortpages-item:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.sortpages-thumbnail img {
    width: 100%;
    height: 200px;
    object-fit: cover;
}

.sortpages-content {
    padding: 15px;
}

.sortpages-content h3 {
    margin: 0 0 10px 0;
    font-size: 1.2em;
}

.sortpages-content a {
    text-decoration: none;
    color: #333;
}

.sortpages-content a:hover {
    color: #0073aa;
}

.sortpages-meta {
    font-size: 0.9em;
    color: #666;
    margin: 5px 0 0 0;
}
</style>


Copy

Insert at cursor
php
このプラグインの特徴：

カスタムフィールドでソート: 任意のカスタムフィールドキーを指定してソート可能

ACF対応: Advanced Custom Fieldsで作成したフィールドも使用可能

サムネイル表示: アイキャッチ画像をサムネイルとして表示

リンク付き: タイトルとサムネイルにページへのリンクを設定

設定可能: ソートフィールド、順序、投稿タイプ、表示数を設定可能

使用方法：

ブロックエディターで「Sort Pages Block」を追加

サイドバーの設定でカスタムフィールドキーを入力

ソート順序と表示数を設定

フロントエンドでソートされたページが表示される


#########################################################

wordpressにgutenbergブロックエディタで使用するプラグインを作りプラグインディレクトリに配置しました。wordpressを開いてこのプラグインを有効化して投稿ページを編集中にブロックエディタの一覧を開きました。しかし先程有効化したブロックエディタ用のプラグインが見つかりません。どこに問題がある可能性がありますか？
自作したブロックエディタ用プラグインが有効化されているにもかかわらず、エディタの一覧（ブロックインサーター）に表示されない場合、主に以下の5つのポイントに問題がある可能性があります。
1. PHP側でのブロック登録漏れ
プラグインを有効化しただけでは不十分で、PHP側で register_block_type 関数を実行して、WordPressにブロックの存在を知らせる必要があります。
確認事項: メインのPHPファイル内で init アクションにフックして登録しているか確認してください。
php
add_action( 'init', function() {
    // block.json があるディレクトリを指定
    register_block_type( __DIR__ . '/build' ); 
} );
コードは注意してご使用ください。

※パスが間違っていると登録されません。 
2. block.json の記述ミス
ブロックの定義ファイルである block.json に誤りがあると、読み込みに失敗します。
APIバージョン: WordPress 6.3以降であれば "apiVersion": 3 が推奨されます。
editorScript: ビルド後のJavaScriptファイル（例: file:./index.js）が正しく指定されているか確認してください。
カテゴリ: "category": "text" など、実在するカテゴリが指定されているか確認してください。 
3. ビルド（コンパイル）の未実行
@wordpress/create-block などの開発ツールを使用している場合、src フォルダのコードを編集しただけでは反映されません。 
解決策: ターミナルで npm run build を実行し、build フォルダに最新のファイルが生成されているか確認してください。
ブラウザが古いスクリプトをキャッシュしている場合があるため、ブラウザのキャッシュクリアも有効です。 
4. ブラウザコンソールのJavaScriptエラー
ブロックのJavaScriptコードにエラーがあると、エディタ上での登録処理が途中で止まり、一覧に表示されません。
確認方法: エディタ画面で「F12キー」を押し、「コンソール (Console)」タブに赤文字のエラーが出ていないか確認してください。
依存関係（wp-blocks, wp-element 等）が不足している場合もここでエラーが出ます。 
5. クラシックエディタの干渉
もしサイトに Classic Editor プラグイン が導入されており、それが有効な場合は、そもそもブロックエディタ用の機能が動作しません。 
プラグイン一覧から「Classic Editor」を無効化するか、投稿編集画面の右側メニューから「ブロックエディターに切り替え」を選択してください。 

#######################################

sortingpages-bloc/src/edit.jsにてPost Typeを'page'と'post'以外のカスタム投稿ページも一覧で取得したい。


Context
カスタム投稿タイプも取得できるように、 useSelectを使ってWordPressから利用可能な投稿タイプを動的に取得し、SelectControlのオプションに追加します。

カスタム投稿タイプを含む全ての投稿タイプを動的に取得するため、useSelectを追加し、SelectControlのオプションを動的に生成するように修正します。

edit.js
+11
-4

Undo
修正完了しました。以下の変更を行いました：

@wordpress/dataからuseSelectをインポート

useSelectを使ってWordPressから利用可能な投稿タイプを動的に取得

viewableな投稿タイプのみをフィルタリングして、SelectControlのオプションとして使用

これで'page'と'post'以外のカスタム投稿タイプも自動的に一覧に表示され、選択できるようになります。


###############################

gutenberg select('core')で取得できるデータ 一覧
Gutenberg（ブロックエディタ）において、wp.data.select('core')（@wordpress/core-data）を通じて取得できる主なデータおよびセレクターの一覧は以下の通りです。2026年現在も、これらはWordPressのREST APIを介してコアエンティティにアクセスするための主要な手段です。 
1. エンティティレコードの取得 
特定の「種類（kind）」や「名前（name）」を指定して、投稿やユーザーなどのデータを取得します。 
getEntityRecords(kind, name, query): 指定した種類のレコード一覧を取得します（例：投稿一覧、ページ一覧、タグ一覧）。
getEntityRecord(kind, name, key, query): 特定のID（key）に一致する単一のレコードを取得します。
getEditedEntityRecord(kind, name, key): 編集中の（未保存の内容を含む）エンティティデータを取得します。 
2. 一般的な設定・情報の取得
WordPressサイト全体に関する情報を取得します。
getSite(): サイトの設定やタイトルなどのサイト情報を取得します。
getThemeSupports(): 現在有効なテーマがサポートしている機能（post-thumbnails、editor-color-paletteなど）の一覧を取得します。
getPostTypes(): サイトで利用可能なすべての投稿タイプ（post, page, カスタム投稿タイプなど）を取得します。
getTaxonomies(): 利用可能なすべてのタクソノミー（category, post_tagなど）を取得します。 
3. セレクターでよく指定されるエンティティの種類
getEntityRecords などの引数で使用できる代表的な組み合わせです。 
種類 (kind) 	名前 (name)	取得できるデータ
postType	post, page, (カスタム投稿名)	投稿、固定ページなどのコンテンツ
taxonomy	category, post_tag, (カスタム)	カテゴリー、タグなどの分類
root	user	ユーザー情報
root	comment	コメント情報
root	media	メディアライブラリのアイテム
root	site	サイト全体の設定（REST APIの /wp/v2/settings に相当）
4. その他の関連ストア
core そのものではありませんが、よく併用される関連データストアです。
core/editor: 現在編集中の投稿に関するデータ（ID、タイトル、保存状態など）を取得します。
core/block-editor: エディタ内のブロックの状態（選択中のブロック、ブロック一覧など）を管理します。
core/notices: エディタ内に表示される通知メッセージ（成功、エラーなど）を管理します。 
注意点: getEntityRecords などの関数は非同期でデータを取得するため、初回実行時は null を返し、データ取得が完了した後に再レンダリングされて値が返ります。 




undefined
undefined
undefined
11 件のサイト
WordPress ダイナミックブロックでのデータへのアクセス ...
2025/04/16 — wp.data.select('core') は core ストアにアクセスして データを取得するためのインターフェース...

Web Design Leaves

wordpress/core-data – Block Editor Handbook
2021/03/09 — Core Data is a data module intended to simplify access to an...

WordPress Developer Resources

@wordpress/core-data - npm
2026/01/16 — getEntity. ... Returns the entity config given its kind and ...

NPM

すべて表示
ワードプレスのデータベースだとどの表に対応しますか
Gutenbergの wp.data.select('core') で取得できるエンティティ（データ）と、WordPressの実際のデータベース（MySQL/MariaDB）テーブルの対応関係は以下の通りです。 
主要なデータの対応表
セレクター（kind / name） 	対応するデータベーステーブル	備考
postType / post	wp_posts	通常の投稿データ
postType / page	wp_posts	固定ページデータ（post_type列で区別）
taxonomy / category	wp_terms, wp_term_taxonomy	カテゴリー名やその構造情報
taxonomy / post_tag	wp_terms, wp_term_taxonomy	タグ情報
root / user	wp_users, wp_usermeta	ユーザーの基本情報と属性
root / media	wp_posts, wp_postmeta	メディア（post_typeがattachmentのデータ）
root / comment	wp_comments, wp_commentmeta	コメント本文と関連メタデータ
root / site	wp_options	サイトの基本設定（サイト名、URLなど）
注意点：1対1の対応ではない場合がある 
Gutenbergが提供する core データは、データベースを直接操作するのではなく WordPress REST API を介して取得されます。そのため、以下の点に注意が必要です。 
メタデータの統合: getEntityRecord などで取得したオブジェクトには、本体のテーブル（例: wp_posts）だけでなく、関連するメタテーブル（例: wp_postmeta）の内容も meta プロパティとして含まれます。
リレーション: タクソノミー（カテゴリーなど）を取得する場合、内部的には wp_term_relationships テーブルを参照して、投稿と用語の紐付けを解決した状態でデータが返されます。
カスタム投稿タイプ: カスタム投稿タイプも wp_posts に保存されていますが、Gutenbergからアクセスするには、その投稿タイプを登録する際に show_in_rest => true と設定しておく必要があります。 




undefined
undefined
undefined
12 件のサイト
WordPressのデータベースの中身はどうなっているのか？
2023/07/26 — WordPressの投稿・固定ページ・カスタム投稿全てこのテーブルに保存されています。 著者、投稿日時、更新日時、タイト...

wpmake.jp

WordPress の構成一覧 - Qiita
2023/12/21 — WordPressのデータベースのテーブル WordPressでWebサイトを運営する上で、必要不可欠なのがデータベース...

Qiita

wordpress/core-data – Block Editor Handbook
2021/03/09 — Core Data is a data module intended to simplify access to an...

WordPress Developer Resources

すべて表示
useSelectを用いてワードプレス上の全てのデータベースの値を取得できますか
結論から申し上げますと、useSelect を用いてWordPress上の 「全ての」データベース値を取得することはできません。
主な理由は、useSelect が依存している WordPress REST API の制限 にあります。2026年現在も、この設計思想は変わっていません。 
取得できない主なデータ
非公開のメタデータ: データベースの wp_postmeta や wp_usermeta に保存されている値のうち、REST APIに公開（show_in_rest が true）設定されていないカスタムフィールドは取得できません。
システム深部の設定: データベースの wp_options にある全ての値が公開されているわけではなく、セキュリティ上の理由からAPI経由ではアクセスできない設定値が多く存在します。
プラグイン固有の独自テーブル: 多くのプラグインが作成する独自のデータベーステーブルは、そのプラグインが専用のREST APIエンドポイントを提供し、さらにGutenberg用の「データストア」を定義していない限り、useSelect から直接参照することはできません。
機密情報: ユーザーのパスワードハッシュや、サーバーの構成に関わる機密性の高い情報は、API経由での取得が制限されています。 
取得できる範囲
useSelect（および core ストア）でアクセスできるのは、あくまで 「REST APIで公開されているエンティティ」 に限定されます。 
投稿（Post）、固定ページ（Page）、メディア（Media）の基本項目
カテゴリーやタグなどのタクソノミー
ユーザーの基本プロフィール（権限がある場合）
サイトの基本設定（タイトル、キャッチフレーズなど） 
全てのデータを操作・取得したい場合
もしデータベースの全レコードにアクセスする必要がある場合は、以下の手段を検討する必要があります。
PHP（サーバーサイド）: $wpdb クラスを使用して直接SQLクエリを実行する。
カスタムAPI作成: 必要なデータを取得するための独自REST APIエンドポイントをPHPで作成し、それを useSelect や apiFetch で呼び出す。 
したがって、useSelect は「フロントエンド（エディタ上）から 標準的なコンテンツデータ を安全かつリアクティブに扱うための道具」であり、データベース管理ツールのように全データを見抜くためのものではないと理解するのが正確です。 

################################################



